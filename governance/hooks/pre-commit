#!/bin/bash
# Pre-commit hook for autonomous governance
# This hook validates all changes through the governance engine

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

echo "üîç Running Governance CI/CD Pipeline..."

# Run the CI/CD pipeline
cd "$PROJECT_ROOT"
python -m governance.ci_cd --staged-only --report

RESULT=$?

if [ $RESULT -eq 0 ]; then
    echo "‚úÖ Governance validation PASSED"
    exit 0
else
    echo "‚ùå Governance validation FAILED"
    echo ""
    echo "Changes have been auto-reverted."
    echo "Check .roles/LESSONS_LEARNED.md for details."
    exit 1
fi
